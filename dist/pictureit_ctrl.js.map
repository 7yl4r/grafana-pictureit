{"version":3,"sources":["../src/pictureit_ctrl.js"],"names":["ValueColorMapping","value","colorName","ColorMapping","name","color","Sensor","metric","xlocation","ylocation","format","bgcolor","fontColor","size","bordercolor","visible","renderValue","valueFormatted","valueUnit","displayName","link_url","resolvedLink","rectangular","group","Group","alignment","x","y","sameSize","width","_","MetricsPanelCtrl","getWidth","interact","panelDefaults","colorMappings","colorMappingMap","valueMappings","metricValues","seriesList","series","bgimage","sensors","groups","useLabelGroupings","height","templateSrv","sizecoefficient","PictureItCtrl","$scope","$injector","defaults","panel","events","on","onInitEditMode","bind","render","onDataReceived","dataList","dataListLength","length","push","target","datapoints","index","splice","lastSensor","sensor","result","ctrl","map","g","alert","JSON","stringify","addEditorTab","scope","elem","attrs","$panelContainer","find","pixelStrToNum","str","parseInt","substr","getGroup","css","metricMap","keyBy","valueMappingsMap","mapping","dragEventSetup","image","document","getElementById","imageWidth","offsetWidth","sensorWidth","font","newValue","Math","max","panelWidth","ylocationStr","toString","xlocationStr","alignSensors","sizeStr","borderRadius","undefined","replace","effectiveName","mValue","valueMapping","colorMapping","sprintf","window","draggable","inertia","restrict","restriction","endOnly","elementRect","top","left","bottom","right","autoScroll","onmove","event","parseFloat","getAttribute","dx","dy","style","webkitTransform","transform","setAttribute","onend","imageHeight","offsetHeight","xpercentage","ypercentage","newX","round","newY","nextTop","nextX","sensorHeight","renderingCompleted","refreshColorMappings","indexOf","toRemove","templateUrl"],"mappings":"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","file":"pictureit_ctrl.js","sourcesContent":["import _ from \"lodash\";\nimport {MetricsPanelCtrl} from \"app/plugins/sdk\";\nimport \"./sprintf.js\";\nimport \"./angular-sprintf.js\";\nimport getWidth from './stringwidth/strwidth.js';\nimport interact from './libs/interact';\n\nconst panelDefaults = {\n    colorMappings: [],\n    colorMappingMap: [],\n    valueMappings: [],\n    metricValues: [],\n    seriesList: [],\n    series: [],\n    bgimage: '',\n    sensors: [],\n    groups: [],\n    useLabelGroupings: false,\n    height: '400px',\n    width: '100px',\n    templateSrv: null,\n    sizecoefficient: 20\n};\n\nexport class PictureItCtrl extends MetricsPanelCtrl {\n\n\n    constructor($scope, $injector, templateSrv) {\n        super($scope, $injector);\n        _.defaults(this.panel, panelDefaults);\n        this.templateSrv = templateSrv;\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n        this.events.on('panel-initialized', this.render.bind(this));\n        this.events.on('data-received', this.onDataReceived.bind(this));\n        this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n    }\n\n    onDataReceived(dataList) {\n        var dataListLength = dataList.length;\n        this.panel.metricValues = [];\n        for (var series = 0; series < dataListLength; series++) {\n            this.panel.metricValues.push({\n                name: dataList[series].target,\n                value: dataList[series].datapoints[dataList[series].datapoints.length - 1][0]\n            });\n        }\n\n        this.render();\n    }\n\n    deleteSensor(index) {\n        this.panel.sensors.splice(index, 1);\n    }\n\n    addSensor() {\n        if (this.panel.sensors.length === 0) {\n            this.panel.sensors.push(\n                new Sensor('A', 50, 25, '%.2f', 'rgba(0, 0, 0, 0.58)', '#ffffff', 14, 'rgb(251, 4, 4)', true)\n            );\n        } else {\n            var lastSensor = this.panel.sensors[this.panel.sensors.length - 1];\n            this.panel.sensors.push(\n                new Sensor(lastSensor.metric, 50, 25, lastSensor.format, lastSensor.bgcolor, lastSensor.color, lastSensor.size, lastSensor.bordercolor, true)\n            );\n        }\n    }\n\n    moveSensorUp(index) {\n        var sensor = this.panel.sensors[index]\n        this.panel.sensors.splice(index, 1)\n        this.panel.sensors.splice(index-1,0,sensor);\n    }\n\n    moveSensorDown(index) {\n        var sensor = this.panel.sensors[index]\n        this.panel.sensors.splice(index, 1)\n        this.panel.sensors.splice(index+1,0,sensor);\n    }\n\n    deleteGroup(index) {\n        this.panel.groups.splice(index, 1);\n    }\n\n    addGroup() {\n        this.panel.groups.push(\n            new Group('A', \"left\", 200, 200)\n        );\n    }\n\n    getAvailableGroups() {\n\n        var result = ctrl.panel.groups.map(g => g.name);\n        alert(\"RESULT: \" + JSON.stringify(result))\n        return result;\n    }\n\n    onInitEditMode() {\n        this.addEditorTab('Sensor', 'public/plugins/bessler-pictureit-panel/editor.html', 2);\n        this.addEditorTab('Color Mapping', 'public/plugins/bessler-pictureit-panel/colors.html', 3);\n        this.addEditorTab('Value Color Mapping', 'public/plugins/bessler-pictureit-panel/mappings.html', 4);\n    }\n\n    link(scope, elem, attrs, ctrl) {\n        const $panelContainer = elem.find('.panel-container');\n\n        function pixelStrToNum(str) {\n            return parseInt(str.substr(0, str.length - 2));\n        }\n\n        function getGroup(name) {\n            for (let group of ctrl.panel.groups) {\n                if(group.name == name){\n                    return group;\n                }\n            }\n            return null;\n        }\n\n        function render() {\n\n            if (!ctrl.panel.sensors) {\n                return;\n            }\n\n            let width = pixelStrToNum($panelContainer.css(\"width\"));\n            let height = pixelStrToNum($panelContainer.css(\"height\"));\n            let metricMap = _.keyBy(ctrl.panel.metricValues, value => value.name);\n            let valueMappingsMap = _.keyBy(ctrl.panel.valueMappings, mapping => mapping.value);\n\n            for (let sensor of ctrl.panel.sensors) {\n\n                dragEventSetup(sensor);\n\n                let image = document.getElementById('pictureit-image');\n\n                if (image != null) {\n                    let imageWidth = document.getElementById('pictureit-image').offsetWidth;\n                    sensor.size = imageWidth * ctrl.panel.sizecoefficient / 1600\n                }\n\n                var sensorWidth = getWidth(sensor.displayName, { font: 'Arial', size: sensor.size }) + 20;\n                if(ctrl.panel.useLabelGroupings){\n                    var group = getGroup(sensor.group.name)\n                    if(group != null && group.sameSize){\n                        var newValue = Math.max(group.width, sensorWidth);\n                        group.width = newValue;\n                        sensor.width = newValue;\n                    }else{\n                        sensor.panelWidth = sensorWidth + \"px\";  \n                        sensor.width = sensorWidth;\n                    }\n                }else{\n                    sensor.panelWidth = sensorWidth + \"px\";  \n                    sensor.width = sensorWidth;\n                }\n            }\n\n            for (let sensor of ctrl.panel.sensors) {\n                if(ctrl.panel.useLabelGroupings && group.sameSize){\n                    var group = getGroup(sensor.group.name)\n                    if(group != null){\n                        sensor.panelWidth = group.width + \"px\";  \n                        sensor.width = group.width;\n                    }\n                }\n                sensor.visible = sensor.xlocation < width && sensor.ylocation < height;\n                if(!ctrl.panel.useLabelGroupings){\n                    sensor.ylocationStr = sensor.ylocation.toString() + \"px\";\n                    sensor.xlocationStr = sensor.xlocation.toString() + \"px\";\n                }else{\n                    alignSensors();\n                }\n                sensor.sizeStr = sensor.size.toString() + \"px\";\n                sensor.bgcolor = 'rgb(64, 64, 64)';\n                sensor.bordercolor = 'rgb(64, 64, 64)';\n                \n                if(sensor.rectangular){\n                    sensor.borderRadius = '5%'\n                }else{\n                    sensor.borderRadius = '50%'\n                }\n\n                if(sensor.link_url != undefined) {\n                    sensor.resolvedLink =ctrl.templateSrv.replace(sensor.link_url);\n                }\n\n                //We need to replace possible variables in the sensors name\n                var effectiveName = ctrl.templateSrv.replace(sensor.metric);\n\n                var mValue = metricMap[effectiveName];\n                if (mValue === undefined) {\n                    mValue = {name: \"dummy\", value: 'null'};\n                }\n\n                var valueMapping = valueMappingsMap[mValue.value];\n\n                if (valueMapping !== undefined) {\n                    let colorMapping = ctrl.panel.colorMappingMap[valueMapping.colorName];\n                    if (colorMapping !== undefined) {\n                        sensor.bgcolor = colorMapping.color;\n                        sensor.bordercolor = colorMapping.color;\n                    }\n                }\n\n                //finally format the value itself\n                sensor.valueFormatted = sprintf(sensor.format,mValue.value);\n            }\n\n            \n        }\n\n        function dragEventSetup(sensor) {\n            \n            window.interact('#' + sensor.metric).draggable({\n                inertia: true,\n                restrict: {\n                restriction: \"#draggableparent\",\n                endOnly: true,\n                elementRect: { top: 0, left: 0, bottom: 1, right: 1 }\n                },\n                autoScroll: true,\n                onmove: function (event) {\n                    var target = event.target,\n                    // keep the dragged position in the data-x/data-y attributes\n                    x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,\n                    y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;\n\n                    // translate the element\n                    target.style.webkitTransform =\n                    target.style.transform =\n                    'translate(' + x + 'px, ' + y + 'px)';\n\n                    // update the position attributes\n                    target.setAttribute('data-x', x);\n                    target.setAttribute('data-y', y);\n\n                },\n                onend: function (event) {\n                    var target = event.target;\n\n                    let imageHeight = document.getElementById('pictureit-image').offsetHeight;\n                    let imageWidth = document.getElementById('pictureit-image').offsetWidth;\n\n                    let x = target.getAttribute('data-x');\n                    let y = target.getAttribute('data-y')\n\n                    // get percentage of relative distance from starting point \n                    let xpercentage = (x * 100) / imageWidth;\n                    let ypercentage = (y * 100) / imageHeight;\n\n                    // browsers dont render more than 4 decimals so better cut away the others\n                    let newX = parseInt(target.style.left) + xpercentage;\n                    newX = Math.round(newX * 10000) / 10000\n\n                    let newY = parseInt(target.style.top) + ypercentage;\n                    newY = Math.round(newY * 10000) / 10000\n\n                    target.style.webkitTransform =\n                    target.style.transform =\n                    'translate(0px, 0px)';\n                    \n                    // manually set the new style so I don't need to render() again\n                    target.style.left = newX + '%'\n                    target.style.top = newY + '%'\n\n                    // really update the sensor values\n                    sensor.xlocation = newX\n                    sensor.ylocation = newY\n\n                    // reset the starting sensor points\n                    target.setAttribute('data-x', 0);\n                    target.setAttribute('data-y', 0);\n                }\n            });\n        }\n\n        function alignSensors(){\n            for (let group of ctrl.panel.groups) {\n                group.nextTop = undefined;\n                group.nextX = undefined;\n            }\n            for (let sensor of ctrl.panel.sensors) {\n                var sensorHeight = sensor.size + 30;\n                var sensorWidth = sensor.width + 10;\n                var group = getGroup(sensor.group.name)\n                if(group.alignment == \"left\"){\n                    if(group.nextTop === undefined){\n                        group.nextTop = group.y;\n                    }\n                    sensor.ylocationStr = group.nextTop + \"px\";\n                    sensor.xlocationStr = group.x + \"px\";\n                    group.nextTop = group.nextTop + sensorHeight;\n                } else if(group.alignment == \"middle\"){\n                    if(group.nextTop === undefined){\n                        group.nextTop = group.y;\n                    }\n                    sensor.ylocationStr = group.nextTop + \"px\";\n                    if(group.sameSize){\n                        sensor.xlocationStr = (group.x - (group.width/2)) + \"px\";\n                    }else{\n                        sensor.xlocationStr = (group.x - (sensor.width/2))+ \"px\";\n                    }\n                    group.nextTop = group.nextTop + sensorHeight;\n                } else if(group.alignment == \"right\"){\n                    if(group.nextTop === undefined){\n                        group.nextTop = group.y;\n                    }\n                    sensor.ylocationStr = group.nextTop + \"px\";\n                    if(group.sameSize){\n                        sensor.xlocationStr = (group.x - group.width) + \"px\";\n                    }else{\n                        sensor.xlocationStr = (group.x - sensor.width)+ \"px\";\n                    }\n                    group.nextTop = group.nextTop + sensorHeight;\n                } else if(group.alignment == \"top\"){\n                    if(group.nextX === undefined){\n                        group.nextX = group.x;\n                    }\n                    sensor.xlocationStr = group.nextX + \"px\";\n                    sensor.ylocationStr = group.y + \"px\";\n                    group.nextX = group.nextX + sensorWidth;\n                }    \n            }\n        }\n\n        this.events.on('render', function () {\n            render();\n            ctrl.renderingCompleted();\n        });\n    }\n\n    //------------------\n    // Color mapping stuff\n    //------------------\n\n    addColorMapping() {\n        this.panel.colorMappings.push(new ColorMapping('name', '#FFFFFF'));\n        this.refreshColorMappings();\n    }\n\n    removeColorMapping(map) {\n        var index = _.indexOf(this.panel.colorMappings, map);\n        this.panel.colorMappings.splice(index, 1);\n        this.refreshColorMappings();\n    }\n\n    refreshColorMappings() {\n        this.panel.colorMappingMap = _.keyBy(this.panel.colorMappings, mapping => mapping.name);\n        this.render();\n    }\n\n\n    //------------------\n    // Mapping stuff\n    //------------------\n\n    addValueMappingMap() {\n        this.panel.valueMappings.push(new ValueColorMapping('value', ''));\n    }\n\n    removeValueMappingMap(toRemove) {\n        var index = _.indexOf(this.panel.valueMappings, toRemove);\n        this.panel.valueMappings.splice(index, 1);\n        this.render();\n    }\n\n    /* addRangeMappingMap() {\n     this.panel.rangeMappingMap.push({from: '', to: '', text: ''});\n     }\n\n     removeRangeMappingMap(rangeMap) {\n     var index = _.indexOf(this.panel.rangeMaps, rangeMap);\n     this.panel.rangeMappingMap.splice(index, 1);\n     this.render();\n     };*/\n}\n\nfunction ValueColorMapping(value,\n                           colorName) {\n    'use strict';\n    this.value = value;\n    this.colorName = colorName;\n}\n\n\nfunction ColorMapping(name, color) {\n    'use strict';\n    this.name = name;\n    this.color = color;\n}\n\nfunction Sensor(metric,\n                xlocation,\n                ylocation,\n                format,\n                bgcolor,\n                fontColor,\n                size,\n                bordercolor,\n                visible) {\n    'use strict';\n    this.metric = metric;\n    this.xlocation = xlocation;\n    this.ylocation = ylocation;\n    this.format = format;\n    this.bgcolor = bgcolor;\n    this.fontColor = fontColor;\n    this.size = size;\n    this.bordercolor = bordercolor;\n    this.visible = visible;\n    this.renderValue = false;\n    this.valueFormatted = '';\n    this.valueUnit = '';\n    this.displayName = '';\n    this.link_url = '';\n    this.resolvedLink = '';\n    this.rectangular = true;\n    this.group = 'A';\n}\n\nfunction Group(name, alignment, x, y) {\n    'use strict';\n    this.name = name;\n    this.alignment = alignment;\n    this.x = x;\n    this.y = y;\n    this.sameSize = false;\n    this.width = 100;\n}\nPictureItCtrl.templateUrl = 'module.html';\n"]}